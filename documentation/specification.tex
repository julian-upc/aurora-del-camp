\documentclass[11pt]{amsart}

\usepackage{times}
\usepackage{microtype}
\usepackage{amssymb}
\usepackage{paralist}
\usepackage{url}
\usepackage{a4wide}
\usepackage{bbm}

\newcommand{\NN}{\mathbbm{N}}
\newcommand{\ZZ}{\mathbbm{Z}}

\numberwithin{equation}{section}
\newcommand{\ojo}[1]{\textsf{\bfseries\boldmath{#1}}}

\begin{document}

\renewcommand*\descriptionlabel[1]{%
\hspace\labelsep\normalfont\itshape #1:}.

\title{Aurora del Camp -- specification}
\author{Julian Pfeifle}
\date{Version of \today}
\maketitle

This document outlines some of the issues that arise in the
implementation of Gilad's proposal~\cite{buzi11}.

\medskip
Given the availability of powerful free and open source solvers for
integer programs such as CBC~\cite{cbc}, it seems natural to pursue an
integer programming formulation. Of course, free solvers are not as
good as the best commercial ones, but the most recent
benchmarks~\cite{mittelmann11} indicate that CBC is reasonably
competitive; more precisely, it's the most competitive among all
solvers that have an open source license (in the case of CBC, the
``Eclipse Public License'') that permits Gilad to use it commercially
without paying any license fees.

\section{Event-based modeling}


\subsection{Activities to be considered}

In the parlance of \cite{artigues-etal11}, we want to schedule a set
of \emph{activities} subject to certain constraints. In our setup,
each activity is associated to a certain specific part of the
available fields. We refer to these parts or areas as \emph{lots}, and
collect them into a set~$L$. We allow them to have different
sizes.

The activities to be carried out in or on these lots come in two
types: $A=A_c\cup A_s$, where the activities in $A_c$ only affect the
field and are thus common to all crops, and the activities~$A_s$ are
specific to each crop. Moreover, we allow each activity to occur
multiple times, to take into account repeated sowing, harvesting,
etc. The two types consist of the following activities:

\begin{description}
\item[Activities common to all crops]  $ti$~for tilling, $rv$~for
  rotovating, $gm$~for green manure planting, $f\!t$~for fertilizing,
  $bb$~for bed building, $si$~for setting up irrigation, $sr$ for
  setting rows, $we$ for weeding. Since each of these activities can
  occur on each lot, we set
  \[
     A_c 
     \ = \
     \{ ti,\;rv,\;gm,\;f\!t,\;bb,\;si,\;sr,\;we\} \times L \times R.
  \]
  A typical activity in $A_c$ is therefore $(ti,\ell, i)$ for some
  $\ell\in L$ and $i\in R$, which we write as $ti_{\ell, i}$ and take
  to mean ``tilling the lot $\ell$ for the $i$-th time''. Thus,
  $R\subset\NN$ indexes the repetitions of each activity.

\smallskip
\item[Activities specific to a crop] $by$ for buying seeds, $ss$ for
  soaking seeds, $cs$ for cutting or separating cloned seeds, $gc$~for
  false germination and cleaning, $pl$~for planting\footnote{We
    consider transplanting and planting to be the same process.},
  $f\!u$ for fumigating, $th$ for thinning, $tr$ for trimming, $co$
  for covering, $ha$~for harvesting:
  \[
     A_s = \{ by,\;ss,\;cs,\;gc,\;pl,\;f\!u,\;th,\;tr,\;co,\;ha\}
     \times C \times L \times R,
  \]
  where $C$ is the set of crops. A typical activity in~$A_s$ is
  $(ha,c,\ell, i)=ha_{c,\ell, i}$, which means ``harvesting the crop $c\in
  C$ in the lot $\ell\in L$ for the $i$-th time''.
\end{description}

The estimates $|L|=30$, $|R|=5$, $|C|=40$ yield an upper bound of
\[
    8 \times 30 \times 5 + 10 \times 40 \times 30 \times 5
    \ = \
    61\,200
\]
activities in the model, which is a very manageable figure for
commercial solvers, and should also present few problems to free
solvers such as CBC.

We record the precedence constraints between these activities in a directed
acyclic graph~$H$. Thus, $t_1\longrightarrow t_2$ (also written
$t_1<t_2$) is a directed edge in~$H$ if $t_1$~must be completed
before $t_2$~can start.

\subsection{Overview of the model}


We separate the \emph{scheduling} part of the problem, in which the
appropriate sequencing of events is determined, from the
\emph{allocation} part, in which activities and crops are assigned
their proper place in the field. First, the optimal sequencing of
events is determined in a way that respects the available field space
and work force using an \emph{event-based} formulation (see below);
allocation is relegated to a second step. Separating the two phases
makes it easier to formulate each one, and presumably makes them (and
thus, the whole problem) easier to solve.

In general terms, we will plan over several years. In the final
program, there will be an interface to put new activities into a
\emph{task queue} (a set of events that is not scheduled yet), and an
interface to record the actual progress of activities. This act of
recording the real start and end time of activities, environmental
changes, changes in the available work force, etc., sets certain
variables in the problem formulation to fixed, known values, and
allows Gilad to frequently update the solution of the optimization
problem and dynamically take into account the latest developments.


\subsection{Scheduling}

Here we follow \cite{artigues-etal11}. Put briefly, the main
\emph{non-renewable} resource consumed is ``time'', while some of the
\emph{renewable} ones are ``space in the fields'', ``money'' and
``gasoline''. Money is put back into the system by selling the crops,
and field space by tilling the remains of the crop. Gasoline is
renewable, but costs money.

To the activities in $A$ we associate a set~$E$ of \emph{events},
which consist of the acts of starting and finishing each activity
in~$A$; thus, $|E|=2|A|=:n$. In consequence, we may consider
$E=\{1,2,\dots, 2|A|=n\}$ to be totally ordered.  Following
\cite{artigues-etal11}, we introduce the following variables:

\begin{enumerate}
\item A set of binary decision variables 
  \[
     Z
     \ = \
     \big\{z_{a,e}: a\in A, e\in E\big\},
  \]
  where each $z_{a,e}=1$ if and only if activity~$a$ starts at
  event~$e$ or is still in execution at event~$e$.

\smallskip
\item A set of continuous variables
  \[
     T
     \ = \
     \big\{t_e : e\in E\big\}, 
  \]
  that indicate the starting time of each event.
\end{enumerate}

We now adapt the individual constraints from~\cite{artigues-etal11}:

\begin{description}

\item[Not all activities have to execute] We do \emph{not} incorporate
  a constraint $\sum_{e\in E} z_{a,e}=1$ for all $e\in A$, because we
  do not wish to require all activities to execute. This leaves Gilad margin
  to define activities such as ``sowing and harvesting beans for the
  fifth time'' that may or may not take place, but where the decision
  on them having take place or not rests with the optimization problem
  and is not an a-priori input to the problem formulation.

\item[Start at time 0] Setting
  \[
     t_0
     \ = \
     0
  \]
  makes sense, and we do so.

\item[Ordering the execution starts]
  \[
     t_{e+1} 
     \ \ge \
     t_e
     \qquad\text{for all }
      e\in E\text{ with }
      e\ne n-1
  \]

\item 
\end{description}


\subsection{Allocation}


\subsection{Objective function}

Each crop $c\in C$ has a yield of  $y_{c,w}$, depending on the week
$w\in W$ it is planted. 
The objective function we want to  maximize is thus
\[
   f 
   \ = \
   \sum_{c\in C, y\in Y} y_{c,w} \sum_{a\in A} x_{c,w,a}
\]

\subsection{Optimizations in the problem formulation}

As remarked in \cite{artigues-etal11}, there is no need to create
events for the ending of the last activities. 

\section{Server-side technology}

Gilad's intention is to make the program available on a server. That's
fine, except that we need to be able to install c++ and cbc on such a server.

\bibliographystyle{siam}
\bibliography{specification}

\end{document}
